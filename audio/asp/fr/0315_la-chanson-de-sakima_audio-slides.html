<!DOCTYPE html>
<head>
<meta charset="utf-8">
  <title>La chanson de Sakima - Global African Storybook</title>
  <style type="text/css">code{white-space: pre;}</style>
<style>
  html { background-color: black; }
  body { background-color: white; border-radius: 12px}
  /* A section is a slide. It's size is 800x600, and this will never change */
  section {
      font-family: Arial, serif;
      font-size: 14pt;
      text-align: center;
    }
  address, blockquote, dl, fieldset, form, h1, h2, h3, h4, h5, h6, hr, ol, p, pre, table, ul, dl { padding: 10px 20px 10px 20px; }
  h1, h2, h3 {
    text-align: center;
    margin: 10pt 10pt 20pt 10pt;
  }
  ul, ol {
    margin: 10px 10px 10px 50px;
  }
  img {
    width: 40%;
  }
  .license {
    font-size: small;
  }
  .license img {
    width: auto;
  }
  section.titleslide h1 { margin-top: 200px; }
  h1.title { margin-top: 150px; }
  h1 { font-size: 180%; }
  h2 { font-size: 120%; }
  h3 { font-size: 100%; }
  q { quotes: "“" "”" "‘" "’"; }
  blockquote { font-style: italic }
  /* Figures are displayed full-page, with the caption on
     top of the image/video */
  figure {
    background-color: black;
  }
  figcaption {
    margin: 70px;
  }
  footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 40px;
    text-align: right;
    background-color: #F3F4F8;
    border-top: 1px solid #CCC;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
      -moz-transition: left 100ms linear 0s;
      -webkit-transition: left 100ms linear 0s;
      -ms-transition: left 100ms linear 0s;
      transition: left 100ms linear 0s;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { color: red; opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0.2; }
</style>
</head>
<body>

<section id="la-chanson-de-sakima" class="slide level1">
<h1>La chanson de Sakima</h1>
<center>
<img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/01.jpg" />
</center>
  
<p><audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/01.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/01.mp3" type="audio/mpeg"> </audio></p>
</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/02.jpg" /></p>
<p>Sakima vivait avec ses parents et sa petite sœur, qui avait quatre ans. Ils vivaient sur la terre d'un homme riche. Leur hutte à toit de chaume était située au bout d'un rang d'arbres.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/02.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/02.mp3" type="audio/mpeg"> </audio>
<center>
<strong>1</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/03.jpg" /></p>
<p>Quand Sakima avait trois ans, il est devenu malade et perdu sa vue. Sakima était un garçon avec beaucoup de talent.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/03.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/03.mp3" type="audio/mpeg"> </audio>
<center>
<strong>2</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/04.jpg" /></p>
<p>Sakima faisait beaucoup de choses que d'autres garçons de six ans ne faisaient pas. Par exemple, il pouvait se tenir avec les membres plus âgés du village et discuter de questions importantes.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/04.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/04.mp3" type="audio/mpeg"> </audio>
<center>
<strong>3</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/05.jpg" /></p>
<p>Les parents de Sakima travaillaient chez l'homme riche. Ils quittaient leur maison tôt le matin et revenaient tard le soir. Sakima restaient seul chez eux avec sa petite sœur.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/05.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/05.mp3" type="audio/mpeg"> </audio>
<center>
<strong>4</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/06.jpg" /></p>
<p>Sakima adorait chanter des chansons. Un jour sa mère lui demanda, « Où apprends-tu à chanter ces chansons, Sakima? »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/06.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/06.mp3" type="audio/mpeg"> </audio>
<center>
<strong>5</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/07.jpg" /></p>
<p>Sakima répondit, « Elles me viennent tout simplement, maman. Je les entends dans ma tête et ensuite je chante. »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/07.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/07.mp3" type="audio/mpeg"> </audio>
<center>
<strong>6</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/08.jpg" /></p>
<p>Sakima aimait chanter pour sa petite sœur, surtout si elle avait faim. Sa sœur l'écoutait chanter sa chanson préférée. Elle se balançait en écoutant la chanson apaisante.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/08.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/08.mp3" type="audio/mpeg"> </audio>
<center>
<strong>7</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/09.jpg" /></p>
<p>« Peux-tu la chanter encore et encore, Sakima? » sa sœur le suppliait. Sakima acceptait et la chantait encore et encore.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/09.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/09.mp3" type="audio/mpeg"> </audio>
<center>
<strong>8</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/10.jpg" /></p>
<p>Un soir quand ses parents sont revenus chez eux, ils étaient très tranquilles. Sakima savait qu'il y avait un problème.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/10.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/10.mp3" type="audio/mpeg"> </audio>
<center>
<strong>9</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/11.jpg" /></p>
<p>« Qu’est-ce qu'il y a, maman et papa? » Sakima demanda. Sakima apprit que le fils de l'homme riche était disparu. L'homme était très triste et seul.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/11.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/11.mp3" type="audio/mpeg"> </audio>
<center>
<strong>10</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/12.jpg" /></p>
<p>« Je peux chanter pour lui. Il redeviendra peut-être heureux, » Sakima dit à ses parents. Mes ses parents rejetèrent l'idée. « Il est très riche. Tu es seulement un garçon aveugle. Penses-tu vraiment que ta chanson l'aidera? »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/12.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/12.mp3" type="audio/mpeg"> </audio>
<center>
<strong>11</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/13.jpg" /></p>
<p>Toutefois, Sakima ne démissionna pas. Sa petite sœur l'appuyait. Elle disait, « Les chansons de Sakima me calment quand j'ai faim. Elles calmeront l'homme riche aussi. »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/13.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/13.mp3" type="audio/mpeg"> </audio>
<center>
<strong>12</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/14.jpg" /></p>
<p>Le lendemain, Sakima demanda à sa petite sœur de le mener chez l'homme riche.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/14.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/14.mp3" type="audio/mpeg"> </audio>
<center>
<strong>13</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/15.jpg" /></p>
<p>Il se tint sous une grande fenêtre et commença à chanter sa chanson préférée. Lentement, la tête de l'homme riche apparu à travers la grande fenêtre.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/15.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/15.mp3" type="audio/mpeg"> </audio>
<center>
<strong>14</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/16.jpg" /></p>
<p>Les ouvriers arrêtèrent ce qu'ils faisaient. Ils écoutèrent la belle chanson de Sakima. Mais un homme dit, « Personne n'a été capable de consoler le patron. Est-ce que ce garçon aveugle pense qu'il pourra le consoler ? »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/16.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/16.mp3" type="audio/mpeg"> </audio>
<center>
<strong>15</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/17.jpg" /></p>
<p>Sakima termina de chanter sa chanson et s'apprêtait à partir. Mais l'homme riche sorti en vitesse et dit, « S'il te plait, chante encore. »</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/17.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/17.mp3" type="audio/mpeg"> </audio>
<center>
<strong>16</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/18.jpg" /></p>
<p>À ce moment, deux hommes sont venus en apportant quelqu'un sur une civière. Ils avaient trouvé le fils de l'homme riche tabassé et abandonné sur le bord de la route.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/18.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/18.mp3" type="audio/mpeg"> </audio>
<center>
<strong>17</strong>
</center>

</section>
<section class="slide level1">

<p><img src="https://raw.githubusercontent.com/global-asp/asp-imagebank/master/medium/0315/19.jpg" /></p>
<p>L'homme riche fut tellement content de revoir son fils. Il récompensa Sakima pour l'avoir consolé. Il emmena les deux garçons à l'hôpital pour que Sakima puisse retrouver sa vue.</p>
<audio> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/ogg/19.ogg" type="audio/ogg"> <source src="https://raw.githubusercontent.com/global-asp/asp-audio/master/fr/0315_la-chanson-de-sakima/mp3/19.mp3" type="audio/mpeg"> </audio>
<center>
<strong>18</strong>
</center>

</section>
<section class="slide level1">

<h2 id="la-chanson-de-sakima-1">La chanson de Sakima</h2>
<strong>Text:</strong> Ursula Nafula<br> <strong>Illustrations:</strong> Peris Wachuka<br> <strong>Translation:</strong> Alexandra Danahy <br> <strong>Language:</strong> French<br> <strong>Read by:</strong> Alexandra Danahy<br>
<p>
This story is brought to you by the <a href='https://global-asp.github.io/'>Global African Storybook Project</a>, an effort to translate the stories of the <a href='http://africanstorybook.org/'>African Storybook Project</a> into all the languages of the world.
<p>
You can view the original story on the ASP website <a href='http://my.africanstorybook.org/stories/sakima%E2%80%99s-song'>here</a>
<p><div class="license">
<a href="https://global-asp.github.io"><img src="https://global-asp.github.io/logo.png" alt="Global ASP logo" border="0" /></a>
</div>

<p><center><div class="license">
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
</div></center>


</section>


<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
  details { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
  }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  body { display: none; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
  #progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
  }
  figure {
    width: 100%;
    height: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%; height: 100%;
  }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    slides: null,
    progressBar : null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = $$("body > section");
    this.progressBar = $("#progress-bar");
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
  }
  
  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  // Specific params handling
//     if (!+this.params.autoplay)
//       $$.forEach($$("video"), function(v){ v.controls = true });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
      aEvent.preventDefault();
      this.goFullscreen();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getDetails = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("details");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getDetails(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
          video.currentTime = 0;
        }
      }
      var audio = s.$("audio");
      if (audio) {
        if (audio.ended || audio.paused) {
          audio.play();
        } else {
          audio.pause();
          audio.currentTime = 0;
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
        video.currentTime = 0;
      }
      var audio = old.$("audio");
      if (audio) {
        audio.pause();
        audio.currentTime = 0;
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
      var audio = next.$("audio");
      if (audio && !!+this.params.autoplay) {
        audio.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
      $$.forEach(incrementals, function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      $$.forEach(incrementals, function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }

  Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
      requestFullscreen.apply(html);
    }
  }
  
  Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
      return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
  }
  
  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }
  
  function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
  }

  window.onload = init;
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  $$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
  }

</script>
<!-- vim: set fdm=marker: }}} -->
</body>
</html>
